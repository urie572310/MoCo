<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è£ç½®æ„Ÿæ¸¬å™¨å®šä½æ¸¬è©¦</title>
</head>
<body>
    <h2>å–å¾—ç›®å‰ä½ç½®</h2>
    <button id="getLocationBtn">å–å¾—ä½ç½®</button>

    <script>
        function checkSupport() {
            if (!("geolocation" in navigator)) {
                console.log("âŒ æ­¤ç€è¦½å™¨ä¸æ”¯æ´ Geolocation API");
                return false;
            }
            console.log("âœ” æ­¤ç€è¦½å™¨æ”¯æ´ Geolocation");
            return true;
        }

        // è«‹æ±‚ä½ç½®æ¬Šé™ï¼ˆAndroid Chrome / iOS Safariï¼‰
        async function requestPermission() {
            if (!navigator.permissions) {
                console.log("âš  ç„¡æ³•ä½¿ç”¨ Permissions APIï¼Œå¯èƒ½æ˜¯ iOS Safariï¼Œæ”¹ç”¨ geolocation è«‹æ±‚æ¬Šé™");
                return "prompt";
            }

            try {
                const result = await navigator.permissions.query({ name: "geolocation" });
                console.log("ğŸ“Œ ç›®å‰å®šä½æ¬Šé™ç‹€æ…‹ï¼š", result.state);
                return result.state;
            } catch (e) {
                console.log("âš  Permissions API æŸ¥è©¢å¤±æ•—ï¼š", e);
                return "prompt";
            }
        }

      
        function getCurrentLocation() {
            navigator.geolocation.getCurrentPosition(
                (pos) => {
                    const lat = pos.coords.latitude;
                    const lon = pos.coords.longitude;
                    const alt = pos.coords.altitude;  // æµ·æ‹”å¯èƒ½ç‚º nullï¼ˆå–æ±ºæ–¼è£ç½®ï¼‰

                    console.log("ğŸ“ ç·¯åº¦:", lat);
                    console.log("ğŸ“ ç¶“åº¦:", lon);
                    console.log("â›°ï¸ æµ·æ‹”:", alt !== null ? alt + " m" : "ç„¡æ³•å–å¾—æµ·æ‹”");

                },
                (err) => {
                    console.log("âŒ ç„¡æ³•å–å¾—ä½ç½®ï¼š", err.message);
                },
                {
                    enableHighAccuracy: true, 
                    timeout: 5000,
                    maximumAge: 0
                }
            );
        }

        document.getElementById("getLocationBtn").addEventListener("click", async () => {

            if (!checkSupport()) return;

            const perm = await requestPermission();

            
            if (perm === "granted" || perm === "prompt") {
                getCurrentLocation();
            } else {
                console.log("âŒ ä½ç½®æ¬Šé™è¢«æ‹’çµ•ï¼Œç„¡æ³•å–å¾—");
            }
        });
    </script>
</body>
</html>
