<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <title>è¡Œå‹•å³æ™‚é€šè¨Šç‹€æ…‹æ¨¡æ“¬ç³»çµ±</title>
    <style>
        body {
            font-family: Arial;
            background: #f2f2f2;
        }
        #status {
            padding: 10px;
            margin-bottom: 10px;
            background: #fff;
            border-radius: 5px;
        }
        #chatbox {
            height: 300px;
            overflow-y: auto;
            background: #fff;
            padding: 10px;
            border-radius: 5px;
        }
        .me {
            text-align: right;
            margin: 5px 0;
        }
        .me span {
            background: #a7d6ff;
            padding: 6px 10px;
            border-radius: 5px;
            display: inline-block;
        }
        .bot span {
            background: #ddd;
            padding: 6px 10px;
            border-radius: 5px;
            display: inline-block;
        }
        input {
            width: 70%;
            padding: 6px;
        }
        button {
            padding: 6px 10px;
        }
    </style>
</head>
<body>

<h2>ğŸ“± è¡Œå‹•å³æ™‚é€šè¨Šç‹€æ…‹æ¨¡æ“¬ç³»çµ±</h2>

<!-- è¡Œå‹•è£ç½®ç‹€æ…‹é¡¯ç¤º -->
<div id="status">
    ğŸ“¡ è¡Œå‹•ç‹€æ…‹ï¼š<span id="motionStatus">æœªåµæ¸¬</span>
</div>

<!-- èŠå¤©è¦–çª— -->
<div id="chatbox"></div>

<br>
<input type="text" id="msgInput" placeholder="è¼¸å…¥è¨Šæ¯">
<button onclick="sendMessage()">é€å‡º</button>

<script>
/* ===============================
   ch01 JavaScript åŸºç¤
   =============================== */

// èŠå¤©ç´€éŒ„ï¼ˆé™£åˆ—ï¼‰
let chatHistory = [];

// è¡Œå‹•ç‹€æ…‹
let isMoving = false;

/* ===============================
   è¡Œå‹•è£ç½®æ„Ÿæ¸¬å™¨ï¼ˆè¡Œå‹•ï¼‰
   =============================== */
if (window.DeviceMotionEvent) {
    window.addEventListener("devicemotion", function (event) {
        let acc = event.accelerationIncludingGravity;

        // åˆ¤æ–·æ‰‹æ©Ÿæ˜¯å¦åœ¨ç§»å‹•ï¼ˆç°¡å–®åˆ¤æ–·ï¼‰
        if (Math.abs(acc.x) > 2 || Math.abs(acc.y) > 2 || Math.abs(acc.z) > 2) {
            isMoving = true;
            document.getElementById("motionStatus").textContent = "ç§»å‹•ä¸­";
        } else {
            isMoving = false;
            document.getElementById("motionStatus").textContent = "éœæ­¢";
        }

        console.log("è¡Œå‹•ç‹€æ…‹ï¼š", isMoving ? "ç§»å‹•ä¸­" : "éœæ­¢");
    });
} else {
    document.getElementById("motionStatus").textContent = "ä¸æ”¯æ´æ„Ÿæ¸¬å™¨";
}

/* ===============================
   å³æ™‚é€šè¨Šï¼šé€å‡ºè¨Šæ¯
   =============================== */
function sendMessage() {
    let text = document.getElementById("msgInput").value;
    if (text === "") return;

    addMessage("me", text);
    document.getElementById("msgInput").value = "";

    // æ¨¡æ“¬é€šè¨Šå»¶é²
    setTimeout(() => {
        sendToServer(text);
    }, 1000);
}

/* ===============================
   é¡¯ç¤ºè¨Šæ¯
   =============================== */
function addMessage(sender, text) {
    let box = document.getElementById("chatbox");
    let div = document.createElement("div");
    div.className = sender;
    div.innerHTML = "<span>" + text + "</span>";
    box.appendChild(div);

    chatHistory.push({
        sender: sender,
        message: text,
        moving: isMoving
    });

    box.scrollTop = box.scrollHeight;
    console.log("èŠå¤©ç´€éŒ„ï¼š", chatHistory);
}

/* ===============================
   Fetch APIï¼ˆé€šè¨Šï¼‰
   =============================== */
function sendToServer(message) {
    let data = {
        msg: message,
        mobileStatus: isMoving ? "ç§»å‹•ä¸­" : "éœæ­¢"
    };

    fetch("https://httpbin.org/post", {
        method: "POST",
        headers: {
            "Content-Type": "application/json"
        },
        body: JSON.stringify(data)
    })
    .then(response => response.json())
    .then(result => {
        console.log("ä¼ºæœå™¨å›å‚³ï¼š", result);
        addMessage("bot", "è¨Šæ¯å·²é€å‡ºï¼ˆæ¨¡æ“¬å›è¦†ï¼‰");
    })
    .catch(error => {
        console.log("å‚³é€å¤±æ•—", error);
    });
}
</script>

</body>
</html>
